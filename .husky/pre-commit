#!/bin/sh
set -e

echo "ğŸ” Running pre-commit validation checks..."

# Sync VERSION to package.json files
echo "ğŸ“¦ Syncing VERSION file to package.json files..."
if [ -f "VERSION" ]; then
  bash scripts/sync-versions.sh
  # Stage any package.json files that were updated
  git add package.json apps/*/package.json packages/shared/package.json 2>/dev/null || true
fi

# Repository structure validation
echo "ğŸ“ Validating repository structure..."
bash tools/scripts/validation/check-root-directory.sh
bash tools/scripts/validation/check-naming-conventions.sh
bash tools/scripts/validation/check-temporary-files.sh

# Lint staged files and type-check only Shared and BunkBot (path-scoped)
echo "ğŸ§¹ Running code quality checks..."
npx lint-staged
npm run type-check:shared --silent && npm run type-check:bunkbot --silent

echo "âœ… Pre-commit checks completed successfully!"
