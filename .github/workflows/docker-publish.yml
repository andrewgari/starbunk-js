name: Docker Publish

on:
    workflow_call:
        inputs:
            tag:
                required: true
                type: string
    workflow_dispatch:
        inputs:
            tag:
                description: 'Docker image tag'
                required: true
                default: 'latest'

jobs:
    publish:
        runs-on: ubuntu-latest
        steps:
            - name: 📥 Checkout Repository
              uses: actions/checkout@v4

            - name: 🔐 Log in to GitHub Container Registry
              uses: docker/login-action@v2
              with:
                  registry: ghcr.io
                  username: ${{ github.actor }}
                  password: ${{ secrets.GITHUB_TOKEN }}

            - name: 🏗️ Build and Push Docker image
              id: docker_build
              uses: docker/build-push-action@v4
              with:
                  context: .
                  push: true
                  tags: ghcr.io/${{ github.repository }}:${{ inputs.tag }}

            - name: 📝 Image Summary
              run: |
                  echo "### 🐳 Docker Image Published" >> $GITHUB_STEP_SUMMARY
                  echo "| Detail | Value |" >> $GITHUB_STEP_SUMMARY
                  echo "| --- | --- |" >> $GITHUB_STEP_SUMMARY
                  echo "| **Repository** | ghcr.io/${{ github.repository }} |" >> $GITHUB_STEP_SUMMARY
                  echo "| **Tag** | ${{ inputs.tag }} |" >> $GITHUB_STEP_SUMMARY
                  echo "| **Digest** | ${{ steps.docker_build.outputs.digest }} |" >> $GITHUB_STEP_SUMMARY
                  echo "| **Image URL** | [ghcr.io/${{ github.repository }}:${{ inputs.tag }}](https://github.com/${{ github.repository }}/pkgs/container/${{ github.event.repository.name }})|" >> $GITHUB_STEP_SUMMARY
