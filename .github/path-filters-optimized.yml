# Optimized Path-based Filters for Container Builds
# This file separates source code changes from test-only changes for efficient CI/CD

# =============================================================================
# SOURCE CODE FILTERS - Trigger builds and deployments
# =============================================================================

# Shared package source changes - affects ALL containers
shared-src:
  - 'packages/shared/src/**'
  - 'packages/shared/lib/**'
  - 'packages/shared/package.json'
  - 'packages/shared/package-lock.json'
  - 'packages/shared/tsconfig.json'
  - 'packages/shared/Dockerfile*'
  - 'packages/shared/.dockerignore'
  - '!packages/shared/**/*.test.*'
  - '!packages/shared/**/__tests__/**'
  - '!packages/shared/**/tests/**'
  - '!packages/shared/**/*.md'
  - '!packages/shared/docs/**'

# Individual container source code filters
bunkbot-src:
  - 'apps/bunkbot/src/**'
  - 'apps/bunkbot/lib/**'
  - 'apps/bunkbot/package.json'
  - 'apps/bunkbot/package-lock.json'
  - 'apps/bunkbot/tsconfig.json'
  - 'apps/bunkbot/Dockerfile*'
  - 'apps/bunkbot/.dockerignore'
  - '!apps/bunkbot/**/*.test.*'
  - '!apps/bunkbot/**/__tests__/**'
  - '!apps/bunkbot/**/tests/**'
  - '!apps/bunkbot/**/*.md'

djcova-src:
  - 'apps/djcova/src/**'
  - 'apps/djcova/lib/**'
  - 'apps/djcova/package.json'
  - 'apps/djcova/package-lock.json'
  - 'apps/djcova/tsconfig.json'
  - 'apps/djcova/Dockerfile*'
  - 'apps/djcova/.dockerignore'
  - '!apps/djcova/**/*.test.*'
  - '!apps/djcova/**/__tests__/**'
  - '!apps/djcova/**/tests/**'
  - '!apps/djcova/**/*.md'

starbunk-dnd-src:
  - 'apps/starbunk-dnd/src/**'
  - 'apps/starbunk-dnd/lib/**'
  - 'apps/starbunk-dnd/package.json'
  - 'apps/starbunk-dnd/package-lock.json'
  - 'apps/starbunk-dnd/tsconfig.json'
  - 'apps/starbunk-dnd/Dockerfile*'
  - 'apps/starbunk-dnd/.dockerignore'
  - '!apps/starbunk-dnd/**/*.test.*'
  - '!apps/starbunk-dnd/**/__tests__/**'
  - '!apps/starbunk-dnd/**/tests/**'
  - '!apps/starbunk-dnd/**/*.md'

covabot-src:
  - 'apps/covabot/src/**'
  - 'apps/covabot/lib/**'
  - 'apps/covabot/package.json'
  - 'apps/covabot/package-lock.json'
  - 'apps/covabot/tsconfig.json'
  - 'apps/covabot/Dockerfile*'
  - 'apps/covabot/.dockerignore'
  - '!apps/covabot/**/*.test.*'
  - '!apps/covabot/**/__tests__/**'
  - '!apps/covabot/**/tests/**'
  - '!apps/covabot/**/*.md'


# =============================================================================
# CONTAINER BUILD DEPENDENCY MATRIX - Optimized for selective rebuilds
# =============================================================================

# Each container needs rebuilding when:
# 1. Its own source code changes
# 2. Shared package source changes
# 3. Critical infrastructure changes

bunkbot:
  - 'apps/bunkbot/src/**'
  - 'apps/bunkbot/lib/**'
  - 'apps/bunkbot/package.json'
  - 'apps/bunkbot/Dockerfile*'
  - 'packages/shared/src/**'
  - 'packages/shared/lib/**'
  - 'packages/shared/package.json'
  - 'docker-compose*.yml'
  - 'package.json'
  - 'tsconfig.json'
  - '!**/*.test.*'
  - '!**/__tests__/**'
  - '!**/tests/**'
  - '!**/*.md'

djcova:
  - 'apps/djcova/src/**'
  - 'apps/djcova/lib/**'
  - 'apps/djcova/package.json'
  - 'apps/djcova/Dockerfile*'
  - 'packages/shared/src/**'
  - 'packages/shared/lib/**'
  - 'packages/shared/package.json'
  - 'docker-compose*.yml'
  - 'package.json'
  - 'tsconfig.json'
  - '!**/*.test.*'
  - '!**/__tests__/**'
  - '!**/tests/**'
  - '!**/*.md'

starbunk-dnd:
  - 'apps/starbunk-dnd/src/**'
  - 'apps/starbunk-dnd/lib/**'
  - 'apps/starbunk-dnd/package.json'
  - 'apps/starbunk-dnd/Dockerfile*'
  - 'packages/shared/src/**'
  - 'packages/shared/lib/**'
  - 'packages/shared/package.json'
  - 'docker-compose*.yml'
  - 'package.json'
  - 'tsconfig.json'
  - '!**/*.test.*'
  - '!**/__tests__/**'
  - '!**/tests/**'
  - '!**/*.md'

covabot:
  - 'apps/covabot/src/**'
  - 'apps/covabot/lib/**'
  - 'apps/covabot/package.json'
  - 'apps/covabot/Dockerfile*'
  - 'packages/shared/src/**'
  - 'packages/shared/lib/**'
  - 'packages/shared/package.json'
  - 'docker-compose*.yml'
  - 'package.json'
  - 'tsconfig.json'
  - '!**/*.test.*'
  - '!**/__tests__/**'
  - '!**/tests/**'
  - '!**/*.md'


# =============================================================================
# TEST-ONLY FILTERS - Trigger tests but not builds
# =============================================================================

# Test files that should only trigger test runs
tests-only:
  - '**/*.test.ts'
  - '**/*.test.js'
  - '**/*.spec.ts'
  - '**/*.spec.js'
  - '**/__tests__/**'
  - '**/tests/**'
  - 'jest.config.js'
  - 'apps/*/jest.config.js'

# Container-specific test filters
bunkbot-tests:
  - 'apps/bunkbot/**/*.test.*'
  - 'apps/bunkbot/**/__tests__/**'
  - 'apps/bunkbot/**/tests/**'
  - 'apps/bunkbot/jest.config.js'

djcova-tests:
  - 'apps/djcova/**/*.test.*'
  - 'apps/djcova/**/__tests__/**'
  - 'apps/djcova/**/tests/**'
  - 'apps/djcova/jest.config.js'

starbunk-dnd-tests:
  - 'apps/starbunk-dnd/**/*.test.*'
  - 'apps/starbunk-dnd/**/__tests__/**'
  - 'apps/starbunk-dnd/**/tests/**'
  - 'apps/starbunk-dnd/jest.config.js'

covabot-tests:
  - 'apps/covabot/**/*.test.*'
  - 'apps/covabot/**/__tests__/**'
  - 'apps/covabot/**/tests/**'
  - 'apps/covabot/jest.config.js'

shared-tests:
  - 'packages/shared/**/*.test.*'
  - 'packages/shared/**/__tests__/**'
  - 'packages/shared/**/tests/**'
  - 'packages/shared/jest.config.js'

# =============================================================================
# CRITICAL INFRASTRUCTURE - Always triggers full rebuild
# =============================================================================

# Container validation workflows and related infrastructure
container-validation:
  - '.github/workflows/pr-validation.yml'
  - '.github/path-filters*.yml'

critical-infrastructure:
  - '.github/workflows/**'
  - '.github/actions/**'
  - '.github/path-filters*.yml'
  - 'package.json'
  - 'package-lock.json'
  - 'tsconfig.json'
  - 'docker-compose*.yml'
  - '.eslintrc*'
  - '.prettierrc*'
  - '.nvmrc'
  - '.node-version'
  - 'Dockerfile'
  - '.dockerignore'

# Docker-specific changes
docker-infrastructure:
  - 'docker-compose*.yml'
  - 'Dockerfile*'
  - '.dockerignore'
  - 'apps/*/Dockerfile*'
  - 'apps/*/.dockerignore'

# Root configuration changes
root-config:
  - 'package.json'
  - 'package-lock.json'
  - 'tsconfig.json'
  - '.eslintrc*'
  - '.prettierrc*'
  - 'jest.config.js'
  - '.nvmrc'
  - '.node-version'

# =============================================================================
# DOCUMENTATION AND NON-FUNCTIONAL FILES - Usually no builds needed
# =============================================================================

docs-only:
  - '**/*.md'
  - 'docs/**'
  - '.github/ISSUE_TEMPLATE/**'
  - '.github/PULL_REQUEST_TEMPLATE.md'
  - 'README*'
  - 'CHANGELOG*'
  - 'CONTRIBUTING*'
  - 'LICENSE*'
  - '**/.gitkeep'

# IDE and tooling files that don't affect builds
tooling-only:
  - '.vscode/**'
  - '.idea/**'
  - '**/.DS_Store'
  - '.gitignore'
  - '**/*ignore'

# =============================================================================
# COMPOSITE FILTERS - For advanced workflow orchestration
# =============================================================================

# Any source code change (excluding tests and docs)
any-source-change:
  - 'apps/*/src/**'
  - 'apps/*/lib/**'
  - 'apps/*/package.json'
  - 'package.json'
  - 'tsconfig.json'
  - '!**/*.test.*'
  - '!**/__tests__/**'
  - '!**/tests/**'
  - '!**/*.md'
  - '!docs/**'

# Any infrastructure change requiring full rebuild
any-infrastructure-change:
  - '.github/workflows/**'
  - 'docker-compose*.yml'
  - 'package.json'
  - 'tsconfig.json'
  - '.eslintrc*'
  - 'Dockerfile*'
  - '.dockerignore'

# Dependency changes that might affect multiple containers
dependency-changes:
  - 'package.json'
  - 'package-lock.json'
  - 'packages/shared/package.json'
  - 'packages/shared/package-lock.json'
  - 'apps/*/package.json'
  - 'apps/*/package-lock.json'
