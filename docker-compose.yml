services:
    bunkbot:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: bunkbot
        env_file:
            - .env
        command: node --enable-source-maps dist/bunkbot.js
        # Improve performance with resource limits
        deploy:
            resources:
                limits:
                    cpus: '2'
                    memory: 1G
        volumes:
            - ./data:/app/data:Z
            - /mnt/user/vault/ttrpg/campaigns:/app/data/campaigns:Z,ro
            - ./scripts:/app/scripts:Z,ro
            - ./data/llm_context:/app/data/llm_context:Z
            - ./src/starbunk/bots/strategy-bots:/app/dist/starbunk/bots/strategy-bots:Z,ro
        environment:
            - PYTHONPATH=/app/scripts
            - VECTOR_CONTEXT_DIR=/app/data/llm_context
        # Add user mapping for rootless operation
        user: "1000:1000"  # Adjust these IDs to match your host user/group IDs
