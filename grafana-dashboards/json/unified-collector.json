{
  "title": "Starbunk - Unified Metrics Collector",
  "uid": "starbunk-unified-collector",
  "schemaVersion": 38,
  "version": 1,
  "editable": true,
  "panels": [
    {"type":"stat","title":"Requests rate (5m)","gridPos":{"x":0,"y":0,"w":8,"h":4},
      "targets":[{"expr":"sum(rate(unified_metrics_requests_total[5m])) by (service,component,endpoint)","legendFormat":"{{service}}/{{component}} {{endpoint}}","datasource":"Prometheus"}]
    },
    {"type":"timeseries","title":"Request p90 (ms)","gridPos":{"x":8,"y":0,"w":16,"h":6},
      "targets":[{"expr":"histogram_quantile(0.90, sum by (le, service, component) (rate(unified_metrics_request_duration_ms_bucket[5m])))","legendFormat":"{{service}}/{{component}}","datasource":"Prometheus"}]
    },
    {"type":"stat","title":"Errors rate (5m)","gridPos":{"x":0,"y":4,"w":8,"h":4},
      "targets":[{"expr":"sum(rate(unified_metrics_errors_total[5m])) by (service,component,error_type)","legendFormat":"{{service}}/{{component}} {{error_type}}","datasource":"Prometheus"}]
    },
    {"type":"stat","title":"Service registrations","gridPos":{"x":8,"y":6,"w":8,"h":4},
      "targets":[{"expr":"sum(unified_metrics_service_registrations) by (service,component)","legendFormat":"{{service}}/{{component}}","datasource":"Prometheus"}]
    },
    {"type":"timeseries","title":"Health check p90 (ms)","gridPos":{"x":16,"y":6,"w":8,"h":6},
      "targets":[{"expr":"histogram_quantile(0.90, sum by (le, service, component, status) (rate(unified_metrics_health_check_duration_ms_bucket[5m])))","legendFormat":"{{service}}/{{component}}/{{status}}","datasource":"Prometheus"}]
    },
    {"type":"stat","title":"Circuit breaker activations (5m)","gridPos":{"x":0,"y":10,"w":12,"h":4},
      "targets":[{"expr":"sum(rate(unified_metrics_circuit_breaker_activations_total[5m])) by (service,component,reason)","legendFormat":"{{service}}/{{component}} {{reason}}","datasource":"Prometheus"}]
    },
    {"type":"timeseries","title":"Endpoint throughput (5m)","gridPos":{"x":12,"y":10,"w":12,"h":8},
      "targets":[{"expr":"sum(rate(unified_metrics_requests_total[5m])) by (service,component,endpoint)","legendFormat":"{{service}}/{{component}} {{endpoint}}","datasource":"Prometheus"}]
    },
    {"type":"logs","title":"Logs (all services)","gridPos":{"x":0,"y":18,"w":24,"h":8},"datasource":"Loki",
      "targets":[{"expr":"{com_starbunk_service!\"\"}","refId":"A"}]
    }
  ]
}

