pipeline:
  name: Unraid Functional Check
  identifier: Unraid_Functional_Check
  projectIdentifier: default_project
  orgIdentifier: default
  tags: {}
  stages:
    - stage:
        name: Run Shell Test
        identifier: Run_Shell_Test
        type: CI
        spec:
          cloneCodebase: false
          infrastructure:
            type: KubernetesDirect
            spec:
              connectorRef: unraid_local_docker
              namespace: default
          execution:
            steps:
              - step:
                  type: Run
                  name: System and Persistence Check
                  identifier: System_and_Persistence_Check
                  spec:
                    connectorRef: unraid_local_docker
                    image: alpine
                    shell: Sh
                    mounts:
                      - name: unraid_appdata
                        path: /mnt/unraid_test
                    command: |
                      echo "--- Host Info ---"
                      uname -a
                      if [ -d "/mnt/unraid_test" ]; then
                        echo "Mount point exists. Writing test file..."
                        echo "Harness run at $(date)" > /mnt/unraid_test/pipeline_check.txt
                      else
                        echo "Error: Mount point not found!"
                        exit 1
                      fi
          failureStrategies:
            - onFailure:
                errors:
                  - AllErrors
                action:
                  type: Abort
  volumes:
    - name: unraid_appdata
      spec:
        type: HostPath
        spec:
          path: /mnt/user/appdata/harness-test
